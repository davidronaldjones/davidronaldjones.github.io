<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>David Ronald Jones</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,700;1,300&family=Tangerine&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #ffffff;
            color: #333333;
        }
        .header {
            text-align: center;
            padding: 80px 20px 40px 20px;
            background-color: #fff;
            color: #212427;
            font-family: "Tangerine", cursive;
            font-weight: 400;
            font-style: normal;
        }
        .header h1 {
            margin: 0;
            font-size: 3.8em;
        }
        .filter-buttons {
            text-align: center;
            padding: 20px 0px 5px 0px;
            background-color: #ffffff;
        }
        .filter-buttons button {
            display: inline-block;
            margin: 5px 0;
            padding: 5px 20px;
            border: none;
            background: none;
            color: #212427;
            cursor: pointer;
            font-family: "Open Sans", sans-serif;
            font-weight: 300;
            font-style: normal;
            font-size: 1em;
            border-right: 1px solid #000000;
            text-align: center;
            vertical-align: middle;
            line-height: 1.5;
            text-decoration: none;
        }
        .filter-buttons button:last-of-type {
            border-right: none;
        }
        .filter-buttons button:hover {
            color: #555555;
        }
        .filter-buttons button.active {
            color: #777;
            font-weight: 700;
        }
        .grid {
            max-width: 940px;
            margin: 0 auto;
            padding: 20px;
            background-color: #ffffff;
        }
        @media (max-width: 980px) {
            .grid {
                width: 100%;
                max-width: 940px;
                padding: 10px;
            }
        }
        .grid:empty::before {
            content: 'Loading images...';
            display: block;
            text-align: center;
            color: #666666;
            padding: 20px;
        }
        .grid-item {
            width: 300px;
            margin-bottom: 20px;
            overflow: hidden;
            border-radius: 5px;
            box-shadow: 0 2px 3px rgba(0,0,0,0.1);
            background-color: #ffffff;
        }
        .grid-item img {
            width: 100%;
            height: auto;
            display: block;
        }
        .grid-item a {
            display: block;
            cursor: pointer;
        }
        .grid-item.text {
            width: 900px;
            padding: 20px;
            text-align: left;
            font-family: "Open Sans", sans-serif;
            font-size: 1.1em;
            line-height: 2.2;
            color: #333333;
            box-shadow: 0 2px 3px rgba(0,0,0,0.1);
            background-color: #ffffff;
            border-radius: 5px;
        }
        .grid-item.text .resume-image {
            float: left;
            width: 245px;
            margin: 15px 25px 15px 0px;
            border-radius: 5px;
            box-shadow: 0 2px 3px rgba(0,0,0,0.1);
        }
        .grid-item.text p.heading {
            text-align: center;
            margin: 0 0 10px;
            font-size: 1.6em;
            color: #212427;
            font-weight: 300;
        }
        .grid-item.text h3 {
            margin: 0 0 10px;
            font-size: 1.2em;
            color: #212427;
        }
        .grid-item.text p {
            margin: 10px 0;
        }
        .grid-item.text a {
            color: #212427;
            text-decoration: underline;
            display: inline;
        }
        .grid-item.text a:hover {
            color: #555555;
        }
        .pswp {
            z-index: 10000;
        }
        .pswp__bg {
            background-color: #ffffff !important;
        }
        .pswp__img {
            cursor: default !important;
        }
        .pswp__img--placeholder {
            opacity: 0;
            transition: opacity 0ms;
        }
        .pswp__top-bar, .pswp__caption {
            background-color: rgba(255, 255, 255, 0.8) !important;
            color: #333333 !important;
        }
        .pswp__button {
            filter: brightness(1);
        }
        noscript p {
            color: #ff4444 !important;
        }
    </style>
    <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
    <script src="https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js"></script>
    <link rel="stylesheet" href="css/photoswipe.css">
    <script src="js/photoswipe.umd.min.js"></script>
    <script src="js/photoswipe-lightbox.umd.min.js"></script>
</head>
<body>
    <div class="header">
        <h1>David Ronald Jones</h1>
    </div>
    <div class="filter-buttons">
        <button data-filter="all" class="active">All</button>
        <button data-filter="abstract">Abstract</button>
        <button data-filter="cycle">Cycle of Life</button>
        <button data-filter="france">France</button>
        <button data-filter="ne">New England</button>
        <button data-filter="ontheroad">On the Road</button>
        <button data-filter="places">Places</button>
        <button data-filter="women">Women as Architecture</button>
        <button data-filter="resume">Resum√©</button>
    </div>
    <div class="grid"></div>
    <noscript>
        <p style="text-align: center; color: #f00;">JavaScript is required to view the gallery.</p>
    </noscript>

    <!-- PhotoSwipe HTML structure -->
    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="pswp__bg"></div>
        <div class="pswp__scroll-wrap">
            <div class="pswp__container">
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
            </div>
            <div class="pswp__ui pswp__ui--hidden">
                <div class="pswp__top-bar">
                    <div class="pswp__counter"></div>
                    <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                    <div class="pswp__preloader">
                        <div class="pswp__preloader__icn">
                            <div class="pswp__preloader__cut">
                                <div class="pswp__preloader__donut"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="pswp__share-modal pswp__share-modal--hidden"></div>
                <div class="pswp__caption">
                    <div class="pswp__caption__center"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load items from JSON and initialize Masonry
        fetch('data/images.json')
            .then(response => {
                if (!response.ok) throw new Error('Failed to load images.json');
                return response.json();
            })
            .then(items => {
                const grid = document.querySelector('.grid');
                items.forEach(item => {
                    const gridItem = document.createElement('div');
                    gridItem.className = `grid-item ${item.type === 'text' ? 'text' : ''}`;
                    gridItem.setAttribute('data-tags', item.tags);
                    if (item.type === 'text') {
                        gridItem.innerHTML = `
                            <h3>${item.title}</h3>
                            <p>${item.content}</p>
                        `;
                    } else {
                        gridItem.innerHTML = `
                            <a href="${item.href}" data-pswp-width="${item.width}" data-pswp-height="${item.height}">
                                <img src="${item.thumb}" alt="${item.alt}">
                            </a>
                        `;
                    }
                    grid.appendChild(gridItem);
                });

                // Initialize Masonry after items are added
                const msnry = new Masonry(grid, {
                    itemSelector: '.grid-item',
                    columnWidth: 300,
                    gutter: 20,
                    percentPosition: false
                });

                // Trigger layout after images load
                imagesLoaded(grid, function() {
                    msnry.layout();
                });

                // Filter functionality
                const buttons = document.querySelectorAll('.filter-buttons button');
                buttons.forEach(button => {
                    button.addEventListener('click', function() {
                        buttons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                        const filter = this.getAttribute('data-filter');
                        const items = grid.querySelectorAll('.grid-item');
                        items.forEach(item => {
                            const tags = item.getAttribute('data-tags').split(';').map(tag => tag.trim());
                            item.style.display = (filter === 'all' || tags.includes(filter)) ? 'block' : 'none';
                        });
                        msnry.layout();
                    });
                });
            })
            .catch(error => {
                console.error('Error loading items:', error);
                document.querySelector('.grid').innerHTML = '<p style="text-align: center; color: #f00;">Failed to load content. Please try again later.</p>';
            });

        // Initialize PhotoSwipe
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof PhotoSwipeLightbox === 'undefined' || typeof PhotoSwipe === 'undefined') {
                console.error('PhotoSwipe or PhotoSwipeLightbox not loaded. Check local file paths:');
                console.log('js/photoswipe.umd.min.js');
                console.log('js/photoswipe-lightbox.umd.min.js');
                console.log('css/photoswipe.css');
                return;
            }

            const lightbox = new PhotoSwipeLightbox({
                gallery: '.grid',
                children: '.grid-item a',
                showHideAnimationType: 'fade',
                showAnimationDuration: 500,
                hideAnimationDuration: 500,
                zoom: false,
                preload: [1, 2],
                pswpModule: PhotoSwipe
            });

            lightbox.on('imageClickAction', function(e) {
                e.preventDefault();
                lightbox.pswp.close();
            });

            lightbox.on('firstUpdate', function() {
                const pswp = lightbox.pswp;
                pswp.element.style.opacity = '0';
                pswp.on('contentLoadImage', function(e) {
                    if (e.content.state === 'loaded') {
                        pswp.element.style.transition = 'opacity 500ms ease';
                        pswp.element.style.opacity = '1';
                    }
                });
            });

            lightbox.init();
        });
    </script>
</body>
</html>